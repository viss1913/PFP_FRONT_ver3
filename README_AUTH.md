# Инструкция по интеграции SMM AI и PFP Backend

Этот документ описывает два ключевых механизма взаимодействия: SSO для входа агентов и Вебхук для синхронизации данных.

## 1. Общие настройки (.env)
Оба сервиса должны использовать одинаковые ключи:
*   `JWT_SECRET`: Для проверки подписи SSO токенов.
*   `INTERNAL_API_KEY`: Для авторизации запросов к вебхуку.

---

## 2. SSO (Single Sign-On)
Позволяет агенту бесшовно переходить из кабинета PFP в кабинет SMM AI.

### Формат токена (JWT):
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "role": "agent",
  "iat": 1737912000,
  "exp": 1737998400
}
```
*   `id`: UUID агента (строка).
*   `role`: Обязательно `"agent"`.

### Передача:
Фронтенд агента передает токен в заголовке:
`Authorization: Bearer <TOKEN>`

---

## 3. Вебхук синхронизации агентов
Используется для уведомления SMM AI о создании или обновлении агента.

*   **Метод**: `POST`
*   **Путь**: `/api/v1/internal/webhooks/agent-updated`
*   **Заголовок**: `X-Internal-API-Key: <INTERNAL_API_KEY>`

### Тело запроса (JSON):
```json
{
  "uuid": "77be4c6c-5762-42a9-86d2-14218433a5dd",
  "email": "agent@example.com",
  "first_name": "Иван",
  "last_name": "Иванов",
  "phone": "79001234567",
  "telegram_channel": "@invest_channel",
  "region": "Москва",
  "city": "Москва",
  "is_active": true,
  "timezone_offset_minutes": 180
}
```

### Обработка на стороне SMM AI:
1. Проверяет `X-Internal-API-Key`.
2. Ищет агента по `uuid`.
3. Создает новую запись или обновляет существующую.
4. Синхронизирует `telegram_channel` и другие поля.
